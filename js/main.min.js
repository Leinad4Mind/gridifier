var hash=window.location.hash.replace(/#/,""),hashBits,defaults=[["xs",4,0,0,0],["s",4,25,0,0],["m",4,38,1,1],["l",4,60,1,1]],breakpointCount=0,$controls=$("#controls"),$breakpoints=$("#breakpoints"),$btnAdd=$("#btn-add-breakpoint"),$output=$("#output"),$legacy=$("#legacy"),view=function(a,b){return b||(b={}),b.legacy=$legacy.is(":checked"),prepareTemplate(a,b)},gridUnitWidth=function(a,b){return a/b*100},gridUnitSingle=function(a,b,c,d,e,f,g){var h=!0,i=gridUnitWidth(b,c),j=[[".unit",a,b,c].join("-"),[a,b,c].join("-")].join(", ."),k=[".unit-offset",a,b,c].join("-"),l=[".unit-push",a,b,c].join("-"),m=[".unit-pull",a,b,c].join("-"),n=[];return d.forEach(function(a){i==a&&(h=!1)}),h&&(d.push(i),e.push(j),n.push([j," {\n  width: ",i.toFixed(4),"%;\n}\n\n"].join("")),f&&n.push([k," {\n  margin-left: ",i.toFixed(4),"%;\n}\n\n"].join("")),g&&(n.push([l," {\n  left: ",i.toFixed(4),"%;\n}\n\n"].join("")),n.push([m," {\n  left: -",i.toFixed(4),"%;\n}\n\n"].join("")))),n},gridUnits=function(a,b,c,d){var e=[100],f=[],g=[],h=2,i=1;for(3>b&&(b=3),g.push(view("grid-unit-all-sizes",{prefix:a})),g.push(view("grid-unit-1",{prefix:a})),c&&g.push(view("grid-unit-offset-0",{prefix:a})),d&&g.push(view("grid-unit-push-pull-0",{prefix:a})),h=2;b>=h;h++)for(i=1;h>=i;i++)g=g.concat(gridUnitSingle(a,i,h,e,f,c,d));return g.push([f.join(",").replace(/ /g,"")," {\n  ",view("grid-unit"),"}\n"].join("")),g};$controls.on("keyup change submit",function(a){var b=[],c="",d=[];a.preventDefault(),$breakpoints.children().each(function(){var a=$.trim($(this).find(".prefix").val()),c=$.trim($(this).find(".columns").val()),e=$(this).find(".add-offsets").is(":checked"),f=$(this).find(".add-push-pull").is(":checked"),g=$.trim($(this).find(".min-width").val()),h=parseInt(g,10)>0;h?(d.push([a,c,g,e?1:0,f?1:0]),b.push(view("media-query",{"min-width":g,css:gridUnits(a,c,e,f).join("")}))):(d.push([a,c,0,e?1:0,f?1:0]),b=b.concat(gridUnits(a,c,e,f)))}),c=[view("grid-base",{build:window.location.protocol+"//"+window.location.host+window.location.pathname+"#"+d.join(";"),"grid-unit":view("grid-unit"),main:b.join("")})],$output.html(c),window.location.hash=d.join(";")}),$btnAdd.on("click",function(){var a=20,b=new Array(100).join("x"),c=[];c=defaults[breakpointCount]?defaults[breakpointCount]:[b.substr(0,breakpointCount-(defaults.length-1))+defaults[defaults.length-1][0],defaults[defaults.length-1][1],defaults[defaults.length-1][2]+(breakpointCount-(defaults.length-1))*a,defaults[defaults.length-1][3],defaults[defaults.length-1][4]],$breakpoints.append(view("breakpoint",{id:breakpointCount,prefix:c[0],columns:c[1],"min-width":c[2],offsets:c[3]?"checked":"","push-pull":c[4]?"checked":""})),breakpointCount++,$controls.trigger("submit")}),$controls.on("click",".btn-remove-breakpoint",function(a){a.preventDefault(),$(this).parent().parent().remove(),breakpointCount--,$controls.trigger("submit")}),hash&&(hashBits=hash.split(";"),defaults=[],hashBits.forEach(function(a){var b=a.split(",");b[3]=1==b[3]?!0:!1,b[4]=1==b[4]?!0:!1,defaults.push(b)})),defaults.forEach(function(){$btnAdd.trigger("click")}),$breakpoints.find(".breakpoint:first-child .breakpoint-em").html('<span class="infinite">âˆž</span>'),$breakpoints.find(".breakpoint:first-child .btn-remove-breakpoint").remove();