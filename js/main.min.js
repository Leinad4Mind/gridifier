var defaultPrefixes=["xs","s","m","l","xl"],defaultMinWidths=[0,25,38,60,90],breakpointCount=0,$controls=$("#controls"),$breakpoints=$("#breakpoints"),$btnAdd=$("#btn-add-breakpoint"),$output=$("#output"),$legacy=$("#legacy"),view=function(a,b){return b||(b={}),b.legacy=$legacy.is(":checked"),prepareTemplate(a,b)},gridUnitWidth=function(a,b){return a/b*100},gridUnitSingle=function(a,b,c,d,e,f){var g=!0,h=gridUnitWidth(b,c),i=[".unit",a,b,c].join("-"),j=[".unit-offset",a,b,c].join("-"),k=[];return d.forEach(function(a){h==a&&(g=!1)}),g&&(d.push(h),e.push(i),k.push([i," {\n  width: ",h.toFixed(4),"%;\n}\n\n"].join("")),f&&k.push([j," {\n  margin-left: ",h.toFixed(4),"%;\n}\n\n"].join(""))),k},gridUnits=function(a,b,c){var d=[100],e=[],f=[],g=2,h=1;for(3>b&&(b=3),f.push(view("grid-unit-hidden",{prefix:a})),f.push(view("grid-unit-1",{prefix:a})),c&&f.push(view("grid-unit-offset-0",{prefix:a})),g=2;b>=g;g++)for(h=1;g>=h;h++)f=f.concat(gridUnitSingle(a,h,g,d,e,c));return f.push([e.join(",")," {\n  ",view("grid-unit"),"}\n"].join("")),f};$controls.on("keyup change submit",function(a){var b=[view("grid-base",{"grid-unit":view("grid-unit")})];a.preventDefault(),$breakpoints.children().each(function(){var a=$(this).find(".prefix").val(),c=$(this).find(".columns").val(),d=$(this).find(".add-offsets").is(":checked"),e=$(this).find(".min-width"),f=e.length;f?b.push(view("media-query",{"min-width":e.val(),css:gridUnits(a,c,d).join("")})):b=b.concat(gridUnits(a,c,d))}),$output.html(b.join(""))}),$btnAdd.on("click",function(){var a=defaultMinWidths.length-1,b=20,c=new Array(100).join("x");$breakpoints.append(view("breakpoint",{id:breakpointCount,columns:$breakpoints.children(".breakpoint:last-child").find(".columns").val()||4,prefix:defaultPrefixes[breakpointCount]||c.substr(0,breakpointCount-a)+defaultPrefixes[a],"min-width":defaultMinWidths[breakpointCount]||defaultMinWidths[a]+(breakpointCount-a)*b})),breakpointCount++,$controls.trigger("submit")}),$controls.on("click",".btn-remove-breakpoint",function(a){a.preventDefault(),$(this).parent().parent().remove(),breakpointCount--,$controls.trigger("submit")}),$btnAdd.trigger("click"),$breakpoints.children().find(".btn-remove-breakpoint, .min-width").remove(),$controls.trigger("submit");